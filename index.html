<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <meta name='Author' content='Tyler Normile'/>
    <meta name='Description' content='Javascript Alarm Clock Tyler Normile Tyler_N' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Alarm Clock &amp; Timer</title>
    <link rel='stylesheet' href='css/bootstrap.min.css' type='text/css' />
    <link href="css/clockpicker.css" rel="stylesheet"> 
    <link href="css/animate.min.css" rel="stylesheet"> 
    <link href="css/style.css" rel="stylesheet"> 
  </head>
  <body id="home">
    <div id="wrap">
      <div class="container">
        <div class="row">
          <div class="panel panel-default">
            <div class="panel-body text-center">
              <div id="date">
                <h3></h3>
              </div>
              <div id="real-time-clock">
                <h1></h1>
                <div id="alarm-tm" class="hdn"><p>No Alarm set</p></div>
              </div>
            </div>
          </div>
        </div>
      </div> 
      <div class="container">
        <div class="row">
          <div class="jumbotron text-center">
          <button type="button" id="btn-reset" class="btn btn-danger btn-xs hdn">Reset</button>
            <div id="control">
              <div id="btn-control">
                <button type="button" id="btn-alarm" class="btn btn-primary" style="margin-right:50px;">Alarm</button>
                <button type="button" id="btn-timer" class="btn btn-primary">Timer</button>
              </div>
            </div>
            <div id="status"><span><p class="hdn">status</p></span></div>
            <audio id="alm-snd">
              <source src="alarm_beep.mp3" type="audio/mpeg">
            </audio>
          </div>
        </div>
      </div>
      <div id="push"></div>
    </div>
    <div id="footer">
      <div class="container text-center">
        <p class="muted credit">Javascript Alarm Clock</p>
      </div>
    </div>
<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/clockpicker.js"></script>
<script>
var gdat = {};
var alms = new Audio('alarm_beep.mp3');
var ae = "webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";

$(document).ready(function() {
  startClock();     // Initialize clock
  // Initial load
  $("#wrap").addClass("animate fadeIn");

  // Alarm select handler
  $("#btn-alarm").click(function(){
    $("#btn-control").empty();          // Clear control(direction) area
    addBtn("btn-reset");
    alarmCntl();
  });

  // Timer click handler
  $("#btn-timer").click(function(){
    $("#btn-control").empty();          // Clear control(direction) area
    addBtn("btn-reset");
    timerCntl();
  });

  // Reset click handler
  $("#btn-reset").click(function(){
    location.reload();      // Reload page (from cache)
  });
});


$(function(){
    var fiveMinutes = 60 * 5,
        display = $('#time'),
        mins, seconds;
    setInterval(function() {
        mins = parseInt(fiveMinutes / 60)
        seconds = parseInt(fiveMinutes % 60);
        seconds = (seconds < 10) ? "0" + seconds : seconds;
        
        display.text(mins + ":" + seconds);
        fiveMinutes--;
        
        if (fiveMinutes < 0) {
            fiveMinutes = 60 * 5;
        }
    }, 1000);
});

// Alarm control
function alarm(){
  alms.play();    // Play alarm sound
  // Show snooze/off control buttons
};

/* Helpers */
function startClock(){
  var today = new Date();       // Date/time obj
  var tdy = "";                 // Today date
  var dd = today.getDate();     // Day
  var mm = today.getMonth()+1;  // Month
  var yy = today.getFullYear(); // Year
  var h = today.getHours();     // Hours
  var m = today.getMinutes();   // Mins
  var s = today.getSeconds();   // Secs
  dd = checkClock(dd);          // Format date output
  mm = checkClock(mm);
  tdy = mm+'/'+dd+'/'+yy;     
  m = checkClock(m);
  s = checkClock(s);
  gdat["curTm"] = ""+h+m;
  var alm_h = "";
  var alm_m = "";
  alm_tm = "";
  if(gdat["alarmSet"] == 1){
    alm_h = gdat["alarmTm"].slice(0,2);
    alm_m = gdat["alarmTm"].slice(3,5);
    alm_tm = alm_h+alm_m;
    if(alm_tm == (""+h+m)){
      alarm();      // Start alarm sequence
    }
  } { 
    // For countdown abilities
  }

 // h = fmtHr(h);
 // var mrd = h.slice(-2);
 // h = h.slice(0,-2);
  $("#date").children('h3').text(tdy);
  $("#real-time-clock").children('h1').text(h +":"+m+":"+s);
  var t = setTimeout(function(){startClock()},500);
}

// Configure clock appearance (single digits)
function checkClock(i) {
  if (i<10) {i = "0" + i};  // add zero in front of numbers < 10
  return i;
};

// Alarm control 
function alarmCntl() {
  var os = '<div class="input-group clockpicker">\
              <input type="text" class="form-control ns" value="06:32">\
              <span class="input-group-addon">\
                <span class="glyphicon glyphicon-time"></span>\
              </span>\
            </div>';
  $("#control").html(os);
  $(".clockpicker").addClass("animate fadeIn");
  var ai = $('.clockpicker').clockpicker({
    placement  : 'bottom',
    align      : 'left',
    donetext   : 'Set Alarm',
    afterDone  : function(){
      var almTime = $(".clockpicker").children(".form-control").val();  
      gdat = {                                // Set global data
        alarmSet : 1,
        alarmTm  : almTime
      }
      setStatus();
    },
  });
};

// Timer control
function timerCntl(){
  var proc = [];
  proc["h"] = 23;
  proc["m"] = 59;
  proc["s"] = 59;
  var os = "";
  os = "<div class='tmr-head'><p style='padding-left:25px;'>Hrs</p><p>Mins</p><p>Secs</p></div><div id='tmr-cntls'><form class='form-inline'>"; 
  for(var key in proc){   // Hours,mins,sec selbox control
    var mx = proc[key];   // Proc limit
    os += "<select id='tmr-"+key+"' class='form-control tmr-sel'>";
    for(var i = 0; i <= mx; i++){
      if(i<10){ i="0"+i; } // Visual choice fix
      os += "<option val='"+i+"'>"+i+"</option>";
    } 
    os += "</select>";   
  }
  os += "</form></div>";
  $("#control").addClass("tmr"); // Control has timer class
  $("#control").html(os);
};

// Add button to dom
function addBtn(x){
  var btn = $("#"+x);
  btn.removeClass("hdn");
  btn.addClass("animate fadeIn");
  btn.one(ae,function(){
    btn.removeClass("animate fadeIn");
  });
};

// Status message control
function setStatus(){
  var stat = $("#status");
  if (gdat["alarmSet"] == 1){               // Alarm is set
    $("#btn-reset").removeClass("hdn");     // Enable reset button control  
    stat.html("<span><p>Alarm Set...</p></span>");
    stat.addClass("animate fadeInUp");
    stat.one(ae,function(){
      stat.removeClass("fadeInUp");
      stat.addClass("fadeOut");
      stat.one(ae,function(){
        stat.find("p").addClass("hdn")
        stat.removeClass("fadeOut");
      });
    });
    var almDisp = $("#alarm-tm");
    almDisp.find("p").text("Alarm Set: "+gdat['alarmTm']);
    almDisp.removeClass("hdn"); 
    almDisp.addClass("animate fadeIn");
    almDisp.one(ae,function(){
      almDisp.removeClass("animate fadeIn");
    });
  } 
};

// Not currently used (12 hour clock conversion)
function fmtHr(h_24) {
    var h = h_24 % 12;
    if (h === 0) h = 12;
    return (h < 10 ? '0' : '') + h + (h_24 < 12 ? 'am' : 'pm');
};
</script>
  </body>
</html>