<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <meta name='Author' content='Tyler Normile'/>
    <meta name='Description' content='Javascript Alarm Clock Tyler Normile Tyler_N' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Alarm Clock &amp; Timer</title>
    <link rel='stylesheet' href='css/bootstrap.min.css' type='text/css' />
    <link href="css/clockpicker.css" rel="stylesheet"> 
    <link href="css/animate.min.css" rel="stylesheet"> 
    <link href="css/style.css" rel="stylesheet"> 
  </head>
  <body id="home">
    <div id="wrap">
      <div class="container">
        <div class="row">
          <div class="panel panel-default">
            <div class="panel-body text-center">
              <div id="date">
                <h3></h3>
              </div>
              <div id="real-time-clock">
                <h1></h1>
              </div>
            </div>
          </div>
        </div>
      </div> 
      <div class="container">
        <div class="row">
          <div class="jumbotron text-center">
          <button type="button" id="btn-reset" class="btn btn-danger btn-xs hdn">Reset</button>
            <h3 id="txt"></h3>
            <div id="control">
              <div id="btn-control">
                <button type="button" id="btn-alarm" class="btn btn-primary" style="margin-right:50px;">Alarm</button>
                <button type="button" id="btn-timer" class="btn btn-primary">Timer</button>
              </div>
            </div>
            <audio id="alm-snd">
              <source src="alarm_beep.mp3" type="audio/mpeg">
            </audio>
          </div>
        </div>
      </div>
      <div id="push"></div>
    </div>
    <div id="footer">
      <div class="container text-center">
        <p class="muted credit">Javascript Alarm Clock</p>
      </div>
    </div>
<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/clockpicker.js"></script>
<!-- <script type="text/javascript" src="js/main.js"></script> -->
<script>
var gdat = {};
var alms = new Audio('alarm_beep.mp3');

$(document).ready(function() {
  startClock();     // Initialize clock
  
$('.clockpicker').clockpicker()
    .find('input').change(function(){
        // TODO: time changed
        console.log(this.value);
    });
$('#demo-input').clockpicker({
    autoclose: true
});
  // Alarm select handler
  $("#btn-alarm").click(function(){
    $("#btn-control").empty();          // Clear control(direction) area
    alarmCntl();

  });

  // Reset click handler
  $("#btn-reset").click(function(){
    location.reload();      // Reload page (from cache)
  });
});

/* Helpers */
function startClock(){
  var today = new Date();       // Date/time obj
  var tdy = "";                 // Today date
  var dd = today.getDate();     // Day
  var mm = today.getMonth()+1;  // Month
  var yy = today.getFullYear(); // Year
  if (dd < 10){
    dd = '0'+ dd;
  }
  if (mm < 10){
    mm = '0'+ mm;
  }
  tdy = mm+'/'+dd+'/'+yy;     // Format date output
  var h = today.getHours();
  var m = today.getMinutes();
  var s = today.getSeconds();
  m = checkClock(m);
  s = checkClock(s);
  gdat["curTm"] = ""+h+m;
  var alm_h = "";
  var alm_m = "";
  alm_tm = "";
  if(gdat["alarmSet"] == 1){
    
    console.log("alarm is set");
    alm_h = gdat["alarmTm"].slice(0,2);
    alm_m = gdat["alarmTm"].slice(3,5);
    alm_tm = alm_h+alm_m;
    if(alm_tm == (""+h+m)){
      console.log("Alarm match!");
      alms.play();
    }
  } else {
    //console.log("alarm not set");
  }

 // h = fmtHr(h);
 // var mrd = h.slice(-2);
 // h = h.slice(0,-2);
  $("#date").children('h3').text(tdy);
  $("#real-time-clock").children('h1').text(h +":"+m+":"+s);
  var t = setTimeout(function(){startClock()},500);
}

// Configure clock appearance (single digits)
function checkClock(i) {
  if (i<10) {i = "0" + i};  // add zero in front of numbers < 10
  return i;
};

// Alarm control 
function alarmCntl() {
  var os = '<div class="input-group clockpicker">\
              <input type="text" class="form-control" value="06:32">\
              <span class="input-group-addon">\
                <span class="glyphicon glyphicon-time"></span>\
              </span>\
            </div>\
            <div id="status"></div>';
  $("#control").html(os);
  var ai = $('.clockpicker').clockpicker({
    placement  : 'bottom',
    align      : 'left',
    donetext   : 'Set',
    afterDone  : function(){
      var almTime = $(".clockpicker").children(".form-control").val();  
      gdat = {                                // Set global data
        alarmSet : 1,
        alarmTm  : almTime
      }
      setStatus();
    },
    beforeShow : function(x){
      getAlmTim();                            // Get alarm time

    },
  });
};

// Status message control
function setStatus(){
  var stat = $("#status");
  var ae = "webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";
  if (gdat["alarmSet"] == 1){               // Alarm is set
    $("#btn-reset").removeClass("hdn");     // Enable reset button control  
    stat.html("<span><p>Alarm Set...</p></span>");
    stat.addClass("animate fadeInUp");
    stat.one(ae,function(){
      stat.removeClass("fadeInUp");
      stat.addClass("fadeOut");
      stat.one(ae,function(){
        stat.find("p").text("");
        stat.removeClass("fadeOut");
      });
    });
  } 
};


// Get user set alarm time
function getAlmTim(){
  var inp = $(".clockpicker").children(".form-control").val();
  console.log(inp); 
  var hr = $("clockpicker-span-hours").text();
  var mn = $("clockpicker-span-minutes").text();
}

// Not currently used (12 hour clock conversion)
function fmtHr(h_24) {
    var h = h_24 % 12;
    if (h === 0) h = 12;
    return (h < 10 ? '0' : '') + h + (h_24 < 12 ? 'am' : 'pm');
};
</script>
  </body>
</html>